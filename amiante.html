<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Scan LICIEL – Synthèse Amiante</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="amiante-page">
  <header class="topbar">
    <div class="topbar-title">Scan LICIEL</div>
    <div class="topbar-subtitle">Synthèse amiante du patrimoine</div>
    <a class="topbar-link" href="index.html">⬅ Retour Dashboard</a>
  </header>

  <main class="amiante-layout">
    <section class="card amiante-hero">
      <div class="amiante-hero__text">
        <p class="pill-label">Amiante</p>
        <h1>Module de présentation amiante</h1>
        <p class="muted">Dépose un fichier Excel de synthèse Amiante (.xlsx) exporté depuis LICIEL pour générer une vue consolidée par ville, adresse et logement.</p>
        <div class="upload-actions">
          <label for="fileInput" class="upload-label">Déposez ou sélectionnez un fichier</label>
          <input type="file" id="fileInput" accept=".xlsx" />
          <button id="generateBtn" class="primary-btn">Générer la synthèse</button>
        </div>
        <div class="upload-hint">Glissez-déposez le fichier sur la zone ci-contre ou utilisez le sélecteur.</div>
      </div>
      <div class="amiante-dropzone" id="dropZone">
        <p class="amiante-dropzone__title">Déposez le fichier Excel ici</p>
        <p class="muted">Seuls les fichiers .xlsx sont pris en charge</p>
      </div>
    </section>

    <section class="card amiante-nav">
      <div id="citySelection" class="navigation-container"></div>
      <div id="addressSelection" class="navigation-container" style="display:none;"></div>
      <div id="logementSelection" class="navigation-container" style="display:none;"></div>
    </section>

    <section id="resultContainer"></section>

    <section class="card amiante-xml">
      <div class="amiante-hero__text">
        <p class="pill-label">Automatique</p>
        <h2>Synthèse construite depuis les XML LICIEL</h2>
        <p class="muted">En ouvrant cette page depuis le module administratif, les fichiers XML amiante sont lus automatiquement et la synthèse est affichée avec la même présentation que l'import Excel.</p>
        <div id="autoXmlStatus" class="upload-hint">En attente des données XML transmises par le module administratif.</div>
        <div class="json-debug">
          <p class="muted">Lecture rapide des fichiers JSON générés pour le débogage :</p>
          <div class="json-debug__actions">
            <button class="secondary-btn" data-json-path="Table_Z_Amiante.json" data-json-label="Table_Z_Amiante.json">Table_Z_Amiante.json</button>
            <button class="secondary-btn" data-json-path="Table_Z_Amiante_prelevements.json" data-json-label="Table_Z_Amiante_prelevements.json">Table_Z_Amiante_prelevements.json</button>
            <button class="secondary-btn" data-json-path="Table_Z_Amiante_General.json" data-json-label="Table_Z_Amiante_General.json">Table_Z_Amiante_General.json</button>
            <button class="secondary-btn" data-json-path="Table_Z_Amiante_Ecart_Norme.json" data-json-label="Table_Z_Amiante_Ecart_Norme.json">Table_Z_Amiante_Ecart_Norme.json</button>
            <button class="secondary-btn" data-json-path="Table_Z_Amiante_doc_remis.json" data-json-label="Table_Z_Amiante_doc_remis.json">Table_Z_Amiante_doc_remis.json</button>
            <button class="secondary-btn" data-json-path="Table_General_Amiante_Analyses.json" data-json-label="Table_General_Amiante_Analyses.json">Table_General_Amiante_Analyses.json</button>
          </div>
          <p class="upload-hint">Les contenus sont ouverts dans une fenêtre modale pour faciliter la lecture ou le copier-coller.</p>
        </div>
      </div>
    </section>
  </main>

  <div id="jsonModal" class="json-modal" role="dialog" aria-modal="true" aria-labelledby="jsonModalTitle" style="display:none;">
    <div class="json-modal__backdrop"></div>
    <div class="json-modal__content">
      <div class="json-modal__header">
        <h3 id="jsonModalTitle">Fichier JSON</h3>
        <button id="closeJsonModal" class="icon-btn" aria-label="Fermer la fenêtre">✕</button>
      </div>
      <pre id="jsonModalBody" class="json-modal__body"></pre>
    </div>
  </div>

  <script src="amiante.js"></script>
</body>
</html>
