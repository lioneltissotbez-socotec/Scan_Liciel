<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Scan LICIEL – Synthèse Amiante</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="amiante-page">
  <header class="topbar">
    <div class="topbar-title">Scan LICIEL</div>
    <div class="topbar-subtitle">Synthèse amiante du patrimoine</div>
    <a class="topbar-link" href="index.html">⬅ Retour Dashboard</a>
  </header>

  <main class="amiante-layout">
    <section class="card amiante-hero">
      <div class="amiante-hero__text">
        <p class="pill-label">Amiante</p>
        <h1>Module de présentation amiante</h1>
        <p class="muted">Dépose un fichier Excel de synthèse Amiante (.xlsx) exporté depuis LICIEL pour générer une vue consolidée par ville, adresse et logement.</p>
        <div class="upload-actions">
          <label for="fileInput" class="upload-label">Déposez ou sélectionnez un fichier</label>
          <input type="file" id="fileInput" accept=".xlsx" />
          <button id="generateBtn" class="primary-btn">Générer la synthèse</button>
        </div>
        <div class="upload-hint">Glissez-déposez le fichier sur la zone ci-contre ou utilisez le sélecteur.</div>
      </div>
      <div class="amiante-dropzone" id="dropZone">
        <p class="amiante-dropzone__title">Déposez le fichier Excel ici</p>
        <p class="muted">Seuls les fichiers .xlsx sont pris en charge</p>
      </div>
    </section>

    <section class="card amiante-nav">
      <div id="citySelection" class="navigation-container"></div>
      <div id="addressSelection" class="navigation-container" style="display:none;"></div>
      <div id="logementSelection" class="navigation-container" style="display:none;"></div>
    </section>

    <section id="resultContainer"></section>

    <section class="card amiante-xml">
      <div class="amiante-hero__text">
        <p class="pill-label">Nouveau</p>
        <h2>Construire la synthèse directement depuis les XML LICIEL</h2>
        <p class="muted">Importez les fichiers <code>Table_Z_Amiante*.xml</code> (général, prélèvements, écarts, documents, matériaux). Nous conservons l'import Excel, mais cette section reconstitue la synthèse sans tableur.</p>
        <div class="upload-actions">
          <label for="xmlInput" class="upload-label">Sélectionnez les XML</label>
          <input type="file" id="xmlInput" accept=".xml" multiple />
          <button id="parseXmlBtn" class="primary-btn">Générer depuis XML</button>
        </div>
        <div class="upload-hint">Tous les XML peuvent être sélectionnés en une seule fois ou ajoutés au fur et à mesure.</div>
      </div>
      <div class="amiante-xml__output">
        <h3>Structure JSON générée</h3>
        <pre id="xmlOutput" class="code-block"></pre>
      </div>
    </section>
  </main>

  <script src="amiante.js"></script>
</body>
</html>
